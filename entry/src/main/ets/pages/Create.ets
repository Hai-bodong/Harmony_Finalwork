// CreatePage.ets
@Entry
@Component
struct CreatePage {
  @State currentTab: string = 'video'
  @State charCount: number = 0
  @State description: string = ''

  build() {
    Column() {
      // å¤´éƒ¨
      this.buildHeader()

      // åˆ›å»ºæ ‡ç­¾é¡µ
      this.buildCreateTabs()

      // é¢„è§ˆåŒºåŸŸ
      this.buildPreviewContainer()

      // ç¼–è¾‘å·¥å…·
      this.buildEditTools()

      // éŸ³ä¹éƒ¨åˆ†
      this.buildMusicSection()

      // æ–‡æœ¬è¾“å…¥
      this.buildTextInput()

      // å‘å¸ƒé€‰é¡¹
      this.buildPublishOptions()

      // åº•éƒ¨å¯¼èˆª
      this.buildBottomNav()
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#000')
  }

  @Builder
  buildHeader() {
    Row() {
      // è¿”å›æŒ‰é’®
      Image($r('app.media.icon_back'))
        .width(20)
        .height(20)
        .onClick(() => {
          // è¿”å›é€»è¾‘
        })

      // æ ‡é¢˜
      Text('åˆ›å»ºå†…å®¹')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .layoutWeight(1)
        .textAlign(TextAlign.Center)

      // å‘å¸ƒæŒ‰é’®
      Button('å‘å¸ƒ', { type: ButtonType.Normal })
        .fontSize(14)
        .fontWeight(FontWeight.Bold)
        .backgroundColor('#FF0050')
        .borderRadius(20)
        .width(80)
        .height(30)
    }
    .padding(20)
    // .border({ bottom: { width: 1, color: 'rgba(255, 255, 255, 0.1)' } })
    .width('100%')
  }

  @Builder
  buildCreateTabs() {
    Row() {
      this.buildCreateTab('video', 'è§†é¢‘')
      this.buildCreateTab('photo', 'ç…§ç‰‡')
      this.buildCreateTab('music', 'éŸ³ä¹')
      this.buildCreateTab('text', 'æ–‡å­—')
    }
    .padding({ top: 10, bottom: 10 })
    // .border({ bottom: { width: 1, color: 'rgba(255, 255, 255, 0.1)' } })
    .width('100%')
  }

  @Builder
  buildCreateTab(type: string, label: string) {
    Column() {
      Text(label)
        .fontSize(16)
        .fontWeight(this.currentTab === type ? FontWeight.Bold : FontWeight.Normal)
        .opacity(this.currentTab === type ? 1 : 0.7)

      if (this.currentTab === type) {
        Divider()
          .width(30)
          .height(3)
          .color('#FF0050')
          .margin({ top: 5 })
      }
    }
    .width('25%')
    .onClick(() => {
      this.currentTab = type
    })
  }

  @Builder
  buildPreviewContainer() {
    Stack() {
      // èƒŒæ™¯
      Column()
        .width('100%')
        .aspectRatio(9/16)
        .backgroundColor('#1a1a1a')

      // é¢„è§ˆå ä½ç¬¦
      Column() {
        Text(this.getPreviewIcon())
          .fontSize(40)
      }
      .width(80)
      .height(80)
      .borderRadius(40)
      .backgroundColor('rgba(255, 255, 255, 0.1)')
    }
    .width('100%')
    .aspectRatio(9/16)
  }

  getPreviewIcon(): string {
    switch (this.currentTab) {
      case 'video': return '+'
      case 'photo': return 'ğŸ“·'
      case 'music': return 'ğŸµ'
      case 'text': return 'ğŸ“'
      default: return '+'
    }
  }

  @Builder
  buildEditTools() {
    Row() {
      this.buildEditTool('âœ‚ï¸', 'è£å‰ª')
      this.buildEditTool('ğŸ¨', 'æ»¤é•œ')
      this.buildEditTool('âœ¨', 'ç‰¹æ•ˆ')
      this.buildEditTool('âš¡', 'è°ƒèŠ‚')
      this.buildEditTool('ğŸ’¬', 'å­—å¹•')
    }
    .justifyContent(FlexAlign.SpaceAround)
    .padding(20)
    // .border({ bottom: { width: 1, color: 'rgba(255, 255, 255, 0.1)' } })
    .width('100%')
  }

  @Builder
  buildEditTool(icon: string, label: string) {
    Column() {
      Text(icon)
        .fontSize(20)
        .width(40)
        .height(40)
        .textAlign(TextAlign.Center)
        .backgroundColor('rgba(255, 255, 255, 0.1)')
        .borderRadius(20)

      Text(label)
        .fontSize(12)
        .opacity(0.8)
    }
  }

  @Builder
  buildMusicSection() {
    Column() {
      // æ ‡é¢˜è¡Œ
      Row() {
        Text('éŸ³ä¹')
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)

        Text('æ›´å¤š')
          .fontSize(14)
          .fontColor('#FF0050')
      }
      .margin({ bottom: 15 })

      // éŸ³ä¹é¡¹
      Row() {
        // å°é¢
        // Image($r('app.media.album_cover1'))
        //   .width(50)
        //   .height(50)
        //   .borderRadius(8)
        //   .objectFit(ImageFit.Cover)

        // ä¿¡æ¯
        Column() {
          Text('æ™šé£è½»æŠš')
            .fontSize(14)
            .fontWeight(FontWeight.Bold)
            .margin({ bottom: 3 })

          Text('è½»éŸ³ä¹å¤§å¸ˆ - å¿ƒçµæ²»æ„ˆç³»åˆ—')
            .fontSize(12)
            .opacity(0.7)
        }
        .layoutWeight(1)
        .margin({ left: 15 })

        // æ³¢å½¢å›¾æ ‡
        Text('â™«')
          .fontSize(18)
          .width(30)
          .textAlign(TextAlign.Center)
      }
    }
    .padding(15)
    // .border({ bottom: { width: 1, color: 'rgba(255, 255, 255, 0.1)' } })
    .width('100%')
  }

  @Builder
  buildTextInput() {
    Column() {
      TextArea({ placeholder: 'æ·»åŠ è§†é¢‘æè¿°...' })
        .width('100%')
        .height(100)
        .backgroundColor('rgba(255, 255, 255, 0)')
        .fontColor('#fff')
        .fontSize(16)
        .placeholderFont({ size: 16, weight: FontWeight.Normal })
        .placeholderColor('rgba(255, 255, 255, 0.5)')
        .onChange((value: string) => {
          this.description = value
          this.charCount = value.length
        })

      Row() {
        Text('#')
          .fontSize(20)
          .opacity(0.7)

        Text(`${this.charCount}/200`)
          .fontSize(14)
          .opacity(0.7)
      }
      .justifyContent(FlexAlign.SpaceBetween)
      .margin({ top: 10 })
      .width('100%')
    }
    .padding(15)
    .backgroundColor('rgba(255, 255, 255, 0.1)')
    .borderRadius(8)
    .margin(15)
  }

  @Builder
  buildPublishOptions() {
    Column() {
      this.buildOptionItem('è°å¯ä»¥çœ‹', 'å…¬å¼€ â€º')
      this.buildOptionItem('å…è®¸è¯„è®º', 'æ‰€æœ‰äºº â€º')
      this.buildOptionItem('åˆ†äº«åˆ°åŠ¨æ€', 'å¼€å¯ â€º')
    }
    .margin(15)
  }

  @Builder
  buildOptionItem(label: string, value: string) {
    Row() {
      Text(label)
        .fontSize(14)

      Text(value)
        .fontSize(14)
        .opacity(0.7)
    }
    .justifyContent(FlexAlign.SpaceBetween)
    .padding({ top: 12, bottom: 12 })
    // .border({ bottom: { width: 1, color: 'rgba(255, 255, 255, 0.1)' } })
    .width('100%')
  }

  @Builder
  buildBottomNav() {
    Row() {
      this.buildNavItem('ğŸ ', 'é¦–é¡µ', false)
      this.buildNavItem('ğŸ”', 'å‘ç°', false)
      this.buildNavItem('+', 'åˆ›å»º', true)
      this.buildNavItem('ğŸ’¬', 'æ¶ˆæ¯', false)
      this.buildNavItem('ğŸ‘¤', 'æˆ‘', false)
    }
    .justifyContent(FlexAlign.SpaceAround)
    .backgroundColor('rgba(0, 0, 0, 0.8)')
    .padding(16)
    // .border({ top: { width: 1, color: 'rgba(255, 255, 255, 0.1)' } })
    .width('100%')
    .position({ x: 0, y: 0 })
  }

  @Builder
  buildNavItem(icon: string, label: string, isActive: boolean) {
    Column() {
      Text(icon)
        .fontSize(24)
        .fontColor(isActive ? '#FF0050' : '#fff')

      Text(label)
        .fontSize(12)
        .fontColor(isActive ? '#FF0050' : '#fff')
    }
  }
}