import router from '@ohos.router'

// CreatePage.ets
@Entry
@Component
struct CreatePage {
  @State currentTab: string = 'video'
  @State charCount: number = 0
  @State description: string = ''
  @State currentBottomTab: number = 2 // é»˜è®¤é€‰ä¸­"åˆ›å»º"é¡µï¼ˆç´¢å¼•2ï¼‰

  build() {
    Column() {
      // å¤´éƒ¨åŒºåŸŸ
      Row() {
        // è¿”å›æŒ‰é’®
        Image($r('app.media.icon_back'))
          .width(30)
          .height(30)
          .margin({ top: 10 })
          .onClick(() => {
            router.back()
          })

        // æ ‡é¢˜
        Text('åˆ›å»ºå†…å®¹')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor(Color.White)
          .layoutWeight(3)
          .textAlign(TextAlign.Center)

        // å‘å¸ƒæŒ‰é’®
        Text('å‘å¸ƒ')
          .fontSize(16)
          .fontColor(Color.White)
          .backgroundColor('#FF0050')
          .padding(8)
          .borderRadius(10)
          .width(60)
          .textAlign(TextAlign.Center)
      }
      .padding(20)
      .border({ width: { bottom: 1.5 }, color: 'rgba(255, 255, 255, 0.1)' })

      // åˆ›å»ºæ ‡ç­¾é¡µ
      Row() {
        ForEach(['video', 'photo', 'music', 'text'], (item: string) => {
          Column({ space: 4 }) {
            Text(this.getTabLabel(item))
              .fontSize(18)
              .fontWeight(this.currentTab === item ? FontWeight.Bold : FontWeight.Normal)
              .opacity(this.currentTab === item ? 1 : 0.7)
              .fontColor(Color.White)
              .padding({ top: 10, bottom: 10, left: 5, right: 5 })
              .textAlign(TextAlign.Center)
              .maxLines(1)

            if (this.currentTab === item) {
              Divider()
                .height(2)
                .backgroundColor('#FF0050')
                .width('60%')
            }
          }
          .width('25%')
          .onClick(() => this.currentTab = item)
        })
      }
      .padding({ top: 10, bottom: 10 })
      .border({ width: { bottom: 1.5 }, color: 'rgba(255, 255, 255, 0.1)' })

      // é¢„è§ˆåŒºåŸŸ
      Stack() {
        Column()
          .width('100%')
          // .aspectRatio(9/16)
          .height(100)
          .backgroundColor('#1a1a1a')

        Column() {
          Text(this.getPreviewIcon())
            .fontSize(40)
            .fontColor(Color.White)
        }
        .width(80)
        .height(80)
        .backgroundColor('rgba(255, 255, 255, 0.1)')
        .borderRadius(40)
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)
      }
      .margin({ top: 5, bottom: 5 })

      // ç¼–è¾‘å·¥å…·
      Row() {
        ForEach(['è£å‰ª', 'æ»¤é•œ', 'ç‰¹æ•ˆ', 'è°ƒèŠ‚', 'å­—å¹•'], (label: string, index: number) => {
          Column() {
            Text(this.getToolIcon(index))
              .fontSize(20)
              .width(40)
              .height(40)
              .backgroundColor('rgba(255, 255, 255, 0.1)')
              .borderRadius(20)
              .fontColor(Color.White)
              .textAlign(TextAlign.Center)

            Text(label)
              .fontSize(12)
              .opacity(0.8)
              .fontColor(Color.White)
              .textAlign(TextAlign.Center)
              .maxLines(1)
          }
          .width('20%')
          .justifyContent(FlexAlign.Center)
        })
      }
      .justifyContent(FlexAlign.SpaceAround)
      .padding(10)
      .border({ width: { bottom: 1.5 }, color: 'rgba(255, 255, 255, 0.1)' })

      // éŸ³ä¹éƒ¨åˆ†
      Column() {
        // æ ‡é¢˜è¡Œ
        Row() {
          Text('éŸ³ä¹')
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor(Color.White)
            .layoutWeight(1)

          Text('æ›´å¤š')
            .fontSize(14)
            .fontColor('#FF0050')
            .margin({ right: 10 })
        }
        .margin({ bottom: 15 })

        // éŸ³ä¹é¡¹
        Row() {
          Image($r('app.media.gradient_bg'))
            .width(50)
            .height(50)
            .borderRadius(8)
            .objectFit(ImageFit.Cover)

          Column() {
            Text('æ™šé£è½»æŠš')
              .fontSize(14)
              .fontWeight(FontWeight.Bold)
              .margin({ bottom: 3 })
              .fontColor(Color.White)
              .maxLines(1)

            Text('è½»éŸ³ä¹å¤§å¸ˆ - å¿ƒçµæ²»æ„ˆç³»åˆ—')
              .fontSize(12)
              .opacity(0.7)
              .fontColor(Color.White)
              .maxLines(1)
          }
          .layoutWeight(1)
          .margin({ left: 15 })
          .justifyContent(FlexAlign.Center)

          Text('â™«')
            .fontSize(18)
            .width(30)
            .textAlign(TextAlign.Center)
            .fontColor(Color.White)
            .margin({ right: 10 })
        }
      }
      .padding(15)
      .border({ width: { bottom: 1.5 }, color: 'rgba(255, 255, 255, 0.1)' })

      // æ–‡æœ¬è¾“å…¥
      Column() {
        TextArea({ placeholder: 'æ·»åŠ è§†é¢‘æè¿°...' })
          .width('100%')
          .height(100)
          .backgroundColor('rgba(255, 255, 255, 0.1)')
          .fontColor(Color.White)
          .fontSize(16)
          .placeholderFont({ size: 16, weight: FontWeight.Normal })
          .placeholderColor('rgba(255, 255, 255, 0.5)')
          .onChange((value: string) => {
            this.description = value
            this.charCount = value.length
          })

        Row() {
          Text('#')
            .fontSize(20)
            .opacity(0.7)
            .fontColor(Color.White)

          Text(`${this.charCount}/200`)
            .fontSize(14)
            .opacity(0.7)
            .fontColor(Color.White)
        }
        .justifyContent(FlexAlign.SpaceBetween)
        .margin({ top: 10 })
        .width('100%')
      }
      .padding(15)
      .backgroundColor('rgba(255, 255, 255, 0.1)')
      .borderRadius(8)
      .margin(15)

      // å‘å¸ƒé€‰é¡¹
      Column() {
        ForEach(['è°å¯ä»¥çœ‹', 'å…è®¸è¯„è®º', 'åˆ†äº«åˆ°åŠ¨æ€'], (label: string) => {
          Row() {
            Text(label)
              .fontSize(14)
              .fontColor(Color.White)
              .layoutWeight(1)
              .textAlign(TextAlign.Start)
              .maxLines(1)

            Text(this.getOptionValue(label))
              .fontSize(14)
              .opacity(0.7)
              .fontColor(Color.White)
              .margin({ right: 10 })
              .maxLines(1)
          }
          .justifyContent(FlexAlign.SpaceBetween)
          .padding({ top: 12, bottom: 12 })
          .width('100%')
          .border({ width: { bottom: 1.5 }, color: 'rgba(255, 255, 255, 0.1)' })
        })
      }
      .margin(15)

      // è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªæ 
      Row() {
        // é¦–é¡µ
        Column() {
          Image($r('app.media.icon_home'))
            .width(24)
            .height(24)
            .objectFit(ImageFit.Contain)
            .margin({ bottom: 4 })
            .colorFilter({
              color: this.currentBottomTab === 0 ? '#F0000' : '#FFFFFF'
            });

          Text('é¦–é¡µ')
            .fontSize(12)
            .fontColor(this.currentBottomTab === 0 ? '#F0000' : '#FFFFFF');
        }
        .width('20%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
        .onClick(() => {
          this.currentBottomTab = 0;
          router.pushUrl({ url: 'pages/Index' });
        });

        // å‘ç°
        Column() {
          Image($r('app.media.icon_find'))
            .width(24)
            .height(24)
            .objectFit(ImageFit.Contain)
            .margin({ bottom: 4 })
            .colorFilter({
              color: this.currentBottomTab === 1 ? '#FF0050' : '#FFFFFF'
            });

          Text('å‘ç°')
            .fontSize(12)
            .fontColor(this.currentBottomTab === 1 ? '#FF0050' : '#FFFFFF');
        }
        .width('20%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
        .onClick(() => {
          this.currentBottomTab = 1;
          router.pushUrl({ url: 'pages/Discover' });
        });

        // åˆ›å»º
        Column() {
          Image($r('app.media.icon_add'))
            .width(24)
            .height(24)
            .objectFit(ImageFit.Contain)
            .margin({ bottom: 4 })
            .colorFilter({
              color: this.currentBottomTab === 2 ? '#FF0050' : '#FFFFFF'
            });

          Text('åˆ›å»º')
            .fontSize(12)
            .fontColor(this.currentBottomTab === 2 ? '#FF0050' : '#FFFFFF');
        }
        .width('20%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
        .onClick(() => {
          this.currentBottomTab = 2;
          router.pushUrl({ url: 'pages/Create' });
        });

        // æ¶ˆæ¯
        Column() {
          Image($r('app.media.icon_message'))
            .width(24)
            .height(24)
            .objectFit(ImageFit.Contain)
            .margin({ bottom: 4 })
            .colorFilter({
              color: this.currentBottomTab === 3 ? '#FF0050' : '#FFFFFF'
            });

          Text('æ¶ˆæ¯')
            .fontSize(12)
            .fontColor(this.currentBottomTab === 3 ? '#FF0050' : '#FFFFFF');
        }
        .width('20%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
        .onClick(() => {
          this.currentBottomTab = 3;
          router.pushUrl({ url: 'pages/Message' });
        });

        // æˆ‘
        Column() {
          Image($r('app.media.icon_profile'))
            .width(24)
            .height(24)
            .objectFit(ImageFit.Contain)
            .margin({ bottom: 4 })
            .colorFilter({
              color: this.currentBottomTab === 4 ? '#FF0050' : '#FFFFFF'
            });

          Text('æˆ‘')
            .fontSize(12)
            .fontColor(this.currentBottomTab === 4 ? '#FF0050' : '#FFFFFF');
        }
        .width('20%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
        .onClick(() => {
          this.currentBottomTab = 4;
          router.pushUrl({ url: 'pages/ProfileCenter' });
        });
      }
      .width('100%')
      .height(60)
      .backgroundColor('#1E1E1E')
      .position({ x: 0, y: '100%' })
      .translate({ y: -60 });
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#000')
  }

  @Builder
  buildNavItem(title: string, index: number, icon: Resource, isActive?: boolean) {
    Column() {
      Image(icon)
        .width(24)
        .height(24)
        .objectFit(ImageFit.Contain)
        .margin({ bottom: 4 })
        .colorFilter({
          color: isActive ? '#FF0050' : '#FFFFFF'
        })

      Text(title)
        .fontSize(12)
        .fontColor(isActive ? '#FF0050' : '#FFFFFF')
        .maxLines(1)
    }
    .width('20%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
    .onClick(() => {
      this.currentBottomTab = index
      if (index !== 2) {
        router.pushUrl({
          url: `pages/${index === 0 ? 'Index' : index === 1 ? 'Discover' : index === 3 ? 'Messages' : 'Profile'}`
        })
      }
    })
  }

  // è·å–æ ‡ç­¾é¡µæ–‡å­—
  getTabLabel(type: string): string {
    switch (type) {
      case 'video': return 'è§†é¢‘'
      case 'photo': return 'ç…§ç‰‡'
      case 'music': return 'éŸ³ä¹'
      case 'text': return 'æ–‡å­—'
      default: return ''
    }
  }

  // è·å–å‘å¸ƒé€‰é¡¹å€¼
  getOptionValue(label: string): string {
    switch (label) {
      case 'è°å¯ä»¥çœ‹': return 'å…¬å¼€ â€º'
      case 'å…è®¸è¯„è®º': return 'æ‰€æœ‰äºº â€º'
      case 'åˆ†äº«åˆ°åŠ¨æ€': return 'å¼€å¯ â€º'
      default: return ''
    }
  }

  // è·å–é¢„è§ˆå›¾æ ‡
  getPreviewIcon(): string {
    switch (this.currentTab) {
      case 'video': return '+'
      case 'photo': return 'ğŸ“·'
      case 'music': return 'ğŸµ'
      case 'text': return 'ğŸ“'
      default: return '+'
    }
  }

  // è·å–å·¥å…·å›¾æ ‡
  getToolIcon(index: number): string {
    const icons: string[] = ['âœ‚ï¸', 'ğŸ¨', 'âœ¨', 'âš¡', 'ğŸ’¬']
    return icons[index]
  }
}
